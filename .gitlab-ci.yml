stages: 
  - build
  

build-bot: #used to build the bot's docker image
  stage: build
  image: docker.io/buildah/buildah
  needs: []
  script:
    - export _BUILDAH_STARTED_IN_USERNS=''
    - export BUILDAH_ISOLATION=chroot
    - export STORAGE_DRIVER=vfs
    - export BUILDAH_FORMAT=docker
    - buildah build-using-dockerfile --tag "${CI_REGISTRY_IMAGE}rostbot:latest" "rostbot"
    - echo "${CI_REGISTRY_IMAGE}/rostbot:latest"
    - buildah push --creds "${CI_REGISTRY_USER}:${CI_JOB_TOKEN}" "rostbot" "${CI_REGISTRY_IMAGE}rostbot:latest"

#deploy-bot:
#  environment: 'production'
#  needs:
#    - build-bot
#  rules: 
#    - if: '$CI_COMMIT_BRANCH == "18-misc-add-continuous-integration"' #Change to master
#
#  stage: deploy
#  image: lachlanevenson/k8s-kubectl
#  script:
#    - kubectl get all
 #   - kubectl apply -f rostbot/deploy-bot.yaml
 #   - kubectl apply -f rostbot/bot-service.yaml
 #   - kubectl apply -f rostbot/bot-ingress.yaml
 #   - sleep 5 
 #   - kubectl get all # display container status

  